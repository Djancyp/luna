# ![lunalogo](https://github.com/Djancyp/lunaexample/blob/main/frontend/src/assets/luna.svg?raw=true) Luna
<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="40" height="40" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M18.1177 14.0442C17.7408 14.1497 17.3586 14.2566 16.9162 14.3768C16.7001 14.438 16.6509 14.4519 16.4498 14.2074C16.2086 13.9194 16.0317 13.7331 15.6939 13.5636C14.6807 13.0384 13.6996 13.1909 12.7829 13.8178C11.6893 14.5632 11.1264 15.6644 11.1425 17.0367C11.1585 18.3921 12.0431 19.5103 13.3137 19.6966C14.4073 19.8491 15.324 19.4425 16.0477 18.5785C16.1924 18.3922 16.3212 18.1887 16.482 17.9516H13.378C13.0402 17.9516 12.9598 17.7314 13.0724 17.4433C13.2815 16.9181 13.6675 16.0372 13.8926 15.5967C13.9409 15.495 14.0535 15.3256 14.2947 15.3256H19.4702C19.7027 14.5496 20.0799 13.8164 20.5831 13.1226C21.7572 11.4961 23.1725 10.649 25.0863 10.2933C26.7268 9.9883 28.2707 10.1577 29.6699 11.1573C30.9405 12.0722 31.7285 13.3089 31.9376 14.9354C32.211 17.2225 31.5838 19.0862 30.0881 20.6787C29.0266 21.8138 27.7239 22.5254 26.2282 22.8473C25.9429 22.9029 25.6576 22.9293 25.3768 22.9553C25.2303 22.9689 25.085 22.9823 24.9416 22.9998C23.478 22.9659 22.1432 22.5254 21.0173 21.5089C20.2256 20.7879 19.6803 19.9019 19.4092 18.8705C19.2211 19.2707 18.9962 19.6539 18.7336 20.0185C17.5756 21.628 16.0638 22.6276 14.15 22.8987C12.5738 23.1189 11.1103 22.797 9.82366 21.7805C8.63353 20.8317 7.95805 19.578 7.78114 18.0194C7.57206 16.1727 8.08671 14.5124 9.14818 13.0554C10.2901 11.4798 11.8019 10.4802 13.6514 10.1244C15.1632 9.8364 16.6106 10.0228 17.9134 10.9546C18.7657 11.5475 19.3769 12.3608 19.779 13.3434C19.8755 13.4959 19.8111 13.5806 19.6181 13.6314C19.0545 13.7822 18.5903 13.9121 18.1177 14.0442ZM28.7581 15.974C28.7613 16.0309 28.7646 16.0909 28.7693 16.1552C28.6889 17.6122 27.9973 18.6965 26.7268 19.3911C25.8744 19.8485 24.9898 19.8994 24.1053 19.4928C22.9473 18.9506 22.3361 17.6122 22.6256 16.2907C22.9795 14.6982 23.9444 13.6986 25.4401 13.3428C26.968 12.9701 28.4316 13.9188 28.7211 15.5961C28.7438 15.7161 28.7505 15.836 28.7581 15.974Z" fill="#00ACD7"/>
<path d="M2.44461 13.8517C2.41244 13.9025 2.42852 13.9364 2.49285 13.9364L7.2826 13.9534C7.33085 13.9534 7.41126 13.9025 7.44343 13.8517L7.71684 13.4112C7.749 13.3604 7.73292 13.3096 7.66859 13.3096H2.95926C2.89493 13.3096 2.81451 13.3435 2.78235 13.3943L2.44461 13.8517Z" fill="#00ACD7"/>
<path d="M0.0160829 15.4103C-0.0160829 15.4611 7.45058e-09 15.495 0.0643316 15.495L6.63928 15.4781C6.70361 15.4781 6.76794 15.4442 6.78402 15.3764L6.91269 14.9698C6.92877 14.919 6.8966 14.8682 6.83227 14.8682H0.530735C0.466404 14.8682 0.385989 14.902 0.353823 14.9529L0.0160829 15.4103Z" fill="#00ACD7"/>
<path d="M3.90813 16.9521C3.87596 17.0029 3.89204 17.0537 3.95638 17.0537L6.43019 17.0707C6.47843 17.0707 6.54277 17.0199 6.54277 16.9521L6.57493 16.5455C6.57493 16.4777 6.54277 16.4269 6.47843 16.4269H4.29412C4.22978 16.4269 4.16545 16.4777 4.13329 16.5285L3.90813 16.9521Z" fill="#00ACD7"/>
</svg>   <svg with="40" height="40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>


Luna is a Golang-based framework that leverages the Echo web framework for server-side rendering (SSR) of React applications. It provides a seamless, full-stack development experience for building dynamic and performant web applications, making it ideal for full-stack developers looking to integrate the power of Golang on the backend with the flexibility of React on the frontend.
> [!WARNING]
> This framework is _beta_ quality. Expect breaking changes and bugs

## DEMO
Check this link for an example production: [Demo](https://mi-deck.com)

## Table of Contents
- [Features](#features)
- [Getting Started](#getting-started)
  - [Installation](#installation)
- [Usage](#usage)
- [Contributing](#contributing)
- [License](#license)

## Features
- Full backend api support with Echo
- SSR with React
- Hot reloading development
- Route based caching
- Custom Middleware support

## Getting Started

### Installation
Ensure you have **Go** and **Yarn** or **npm** installed on your system.
```bash
go get github.com/Djancyp/luna@v1.0.0
```

## usage
```bash
func main() {
  	app, err := luna.New(luna.Config{
		ENV:                 ENV,
		RootPath:            "frontend/",
		PublicPath:          "frontend/public",
		AssetsPath:          "frontend/src/assets",
		ServerEntryPoint:    "frontend/src/entry-server.tsx",
		ClientEntryPoint:    "frontend/src/entry-client.tsx",
		TailwindCSS:         true,
		FaviconPath:         "favicon.svg",
		HotReloadServerPort: 3000,
		Store:               store.ReturnStore,
		Head: pkg.MainHead{
			Attributes: []string{
				`<link rel="manifest" href="/manifest.json" />`,
			},
		},
		Routes: []pkg.ReactRoute{
			{
				Path: "/",
				Head: pkg.Head{
					Title:       "mi-Deck",
					Description: "Home page",
					CssLinks:    googleFont,
				},
				Middleware: []echo.MiddlewareFunc{
					middlewares.UserLoggedin,
				},
				CacheExpiry: time.Now().Add(365 * 24 * time.Hour).Unix(),
			},
			{
				Path: "/dash",
				Head: pkg.Head{
					Title:       "mi-deck - Dash",
					Description: "Dashboard page",
					CssLinks:    googleFont,
				},
				Props: props.ReturnDashProps,
				Middleware: []echo.MiddlewareFunc{
					middlewares.RequireLogin,
				},
			},
			{
				Path: "/decks",
				Head: pkg.Head{
					Title:       "mi-deck - Decks",
					Description: "Decks page",
					CssLinks:    googleFont,
				},
				Props: props.ReturnDeckProps,
				Middleware: []echo.MiddlewareFunc{
					middlewares.RequireLogin,
				},
			},
			{
				Path: "/decks/new",
				Head: pkg.Head{
					Title:       "mi-deck - New Deck",
					Description: "New deck page",
					CssLinks:    googleFont,
				},
				Middleware: []echo.MiddlewareFunc{
					middlewares.RequireLogin,
				},
				CacheExpiry: time.Now().Add(365 * 24 * time.Hour).Unix(),
			},
			{
				Path: "/decks/edit/:id",
				Head: pkg.Head{
					Title:       "mi-deck - Edit Deck",
					Description: "Edit deck page",
					CssLinks:    googleFont,
				},
				Props: props.ReturnEditDeckProps,
				Middleware: []echo.MiddlewareFunc{
					middlewares.RequireLogin,
				},
			},
			{
				Path: "/decks/:id/play",
				Head: pkg.Head{
					Title:       "mi-deck - Edit Deck",
					Description: "Edit deck page",
					CssLinks:    googleFont,
				},
				Props: props.ReturnPlayDeckProps,
				Middleware: []echo.MiddlewareFunc{
					middlewares.RequireLogin,
				},
			},
		},
	})
  // make sure you handle the error
  
  app.Start(":8080")
}


```

#### Global store
Every page has access to this on the frontend. You can use create a provider for this or direct access on your components by 

```jsx
const { store } = store;
```
```go
func ReturnStore(c echo.Context) map[string]interface{} {
	return map[string]interface{}{
		"User": returnUser(c),
	}
}

func returnUser(c echo.Context) map[string]interface{} {
	session, err := gothic.Store.Get(c.Request(), "userSession")
	if err != nil {
		return map[string]interface{}{
			"loggedIn": false,
		}
	}
	if _, ok := session.Values["id"]; !ok {
		return map[string]interface{}{
			"loggedIn": false,
		}
	}
	return map[string]interface{}{
		"loggedIn": true,
		"id":       session.Values["id"],
		"email":    session.Values["email"],
		"name":     session.Values["name"],
    "avatar":   session.Values["picture"],
	}
}

```

#### Page props
Props are page level data that can be passed.
You can Access the data on the frontend by using the store object
```jsx
const { lates, totals, analytics } = props;
```

```go
func ReturnDashProps(c echo.Context, params map[string]string) map[string]interface{} {
  // u can use params to get url params
  // paramId := params["id"]


	// get session
	props := map[string]interface{}{}
	session, err := gothic.Store.Get(c.Request(), "userSession")
	if err != nil {
		return props
	}
	// Check if the user ID is set in the session
	if _, ok := session.Values["id"]; !ok {
		return props
	}
	id := session.Values["id"].(string)
	lates := getLatest(id)
	totals := getTotals(id)
	analytics := getAnalitics(id)
	return map[string]interface{}{
		"lates":     lates,
		"totals":    totals,
		"analytics": analytics,
	}
}

func getLatest(id string) []database.GetDecksByUserIDRow {
	data := []database.GetDecksByUserIDRow{}
	ctx := context.Background()
	db := database.New(database.DB)

	body := database.GetDecksByUserIDParams{
		UserID: id,
		Limit:  2,
		Offset: 0,
	}

	decks, err := db.GetDecksByUserID(ctx, body)
	if err != nil && sql.ErrNoRows != err {
		return data
	}
	if sql.ErrNoRows == err {
		return []database.GetDecksByUserIDRow{}
	}
	if decks == nil {
		return []database.GetDecksByUserIDRow{}
	}

	return decks
}

type Totals struct {
	Decks int64
	Cards int
}

func getTotals(id string) Totals {
	data := Totals{
		Decks: 0,
		Cards: 0,
	}

	if id == "" {
		return data
	}

	ctx := context.Background()
	db := database.New(database.DB)

	deckTotal, err := db.CountDecksByUserID(ctx, id)
	if err != nil && sql.ErrNoRows != err {
		return data
	}

	cardTotal, err := db.CountCardsByUserID(ctx, id)
	if err != nil && sql.ErrNoRows != err {
		return data
	}
	data.Cards = int(cardTotal)

	data.Decks = deckTotal

	return data
}

func getAnalitics(id string) []database.MonthlyUserProgress {
	data := []database.MonthlyUserProgress{}
	if id == "" {
		return data
	}
	ctx := context.Background()
	db := database.New(database.DB)

	analitics, err := db.GetMonthlyUserProgress(ctx, id)
	if err != nil && sql.ErrNoRows != err {
		return data
	}
	if sql.ErrNoRows == err {
		return []database.MonthlyUserProgress{}
	}
	if analitics == nil {
		return []database.MonthlyUserProgress{}
	}
	return analitics
}

```
Check this link for an example project: [Example](https://github.com/Djancyp/lunaexample)



## Contributing

Thank you for considering contributing to this project! Contributions are what make the open-source community such a valuable place to learn, inspire, and create. Any contributions you make are **greatly appreciated**.

To contribute:

1. Fork the repository.
2. Create a branch for your feature (`git checkout -b feature/NewFeature`).
3. Commit your changes (`git commit -m 'Add some NewFeature'`).
4. Push to the branch (`git push origin feature/NewFeature`).
5. Open a pull request.

Please make sure to update tests as appropriate and adhere to the code of conduct in all interactions.


## Special Thanks

- [Echo](https://echo.labstack.com/)
- [Esbuild](https://esbuild.github.io/)
- [Quickjs-go](https://github.com/buke/quickjs-go)

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for more information.
